{"version":3,"file":"FeatureFlags.cjs","sources":["../../../src/types/FeatureFlags.ts"],"sourcesContent":["import { Buffer } from 'buffer';\n\nexport type FeatureFlags = boolean[];\n\n/**\n * Serializes an array of boolean into a Buffer. The `byteSize` parameter\n * can be used to create a fixed-size Buffer, otherwise the Buffer will\n * have the minimum amount of bytes required to store the boolean array.\n *\n * Returns a Buffer whose bits are ordered from left to right, unless\n * `backward` is set to true, in which case the bits are ordered from\n * right to left.\n */\nexport const serializeFeatureFlags = (\n  features: FeatureFlags,\n  byteSize?: number,\n  backward = false\n): Buffer => {\n  byteSize = byteSize ?? Math.ceil(features.length / 8);\n  const bytes: number[] = [];\n\n  for (let i = 0; i < byteSize; i++) {\n    let byte = 0;\n    for (let j = 0; j < 8; j++) {\n      const feature = Number(features[i * 8 + j] ?? 0);\n      byte |= feature << (backward ? j : 7 - j);\n    }\n    if (backward) {\n      bytes.unshift(byte);\n    } else {\n      bytes.push(byte);\n    }\n  }\n\n  return Buffer.from(bytes);\n};\n\n/**\n * Parses a Buffer into an array of booleans using the\n * bits of the buffer. The number of flags can be provided\n * to determine how many booleans to return.\n *\n * Expects the bits in the Buffer to be ordered from left to right,\n * unless `backward` is set to true, we expect the bits to be\n * ordered from right to left.\n */\nexport const deserializeFeatureFlags = (\n  buffer: Buffer,\n  numberOfFlags?: number,\n  backward = false\n): FeatureFlags => {\n  const booleans: boolean[] = [];\n  buffer = backward ? buffer.reverse() : buffer;\n\n  for (let byte of buffer) {\n    for (let i = 0; i < 8; i++) {\n      if (backward) {\n        booleans.push(Boolean(byte & 1));\n        byte >>= 1;\n      } else {\n        booleans.push(Boolean(byte & 0b1000_0000));\n        byte <<= 1;\n      }\n    }\n  }\n\n  return booleans.slice(0, numberOfFlags);\n};\n"],"names":["serializeFeatureFlags","features","byteSize","backward","Math","ceil","length","bytes","i","byte","j","feature","Number","unshift","push","Buffer","from","deserializeFeatureFlags","buffer","numberOfFlags","booleans","reverse","Boolean","slice"],"mappings":";;;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,qBAAqB,GAAG,CACnCC,QADmC,EAEnCC,QAFmC,EAGnCC,QAAQ,GAAG,KAHwB,KAIxB;AACXD,EAAAA,QAAQ,GAAGA,QAAQ,IAAIE,IAAI,CAACC,IAAL,CAAUJ,QAAQ,CAACK,MAAT,GAAkB,CAA5B,CAAvB,CAAA;EACA,MAAMC,KAAe,GAAG,EAAxB,CAAA;;EAEA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,QAApB,EAA8BM,CAAC,EAA/B,EAAmC;IACjC,IAAIC,IAAI,GAAG,CAAX,CAAA;;IACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,MAAA,MAAMC,OAAO,GAAGC,MAAM,CAACX,QAAQ,CAACO,CAAC,GAAG,CAAJ,GAAQE,CAAT,CAAR,IAAuB,CAAxB,CAAtB,CAAA;MACAD,IAAI,IAAIE,OAAO,KAAKR,QAAQ,GAAGO,CAAH,GAAO,CAAIA,GAAAA,CAAxB,CAAf,CAAA;AACD,KAAA;;AACD,IAAA,IAAIP,QAAJ,EAAc;MACZI,KAAK,CAACM,OAAN,CAAcJ,IAAd,CAAA,CAAA;AACD,KAFD,MAEO;MACLF,KAAK,CAACO,IAAN,CAAWL,IAAX,CAAA,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,OAAOM,aAAM,CAACC,IAAP,CAAYT,KAAZ,CAAP,CAAA;AACD,EAtBM;AAwBP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMU,uBAAuB,GAAG,CACrCC,MADqC,EAErCC,aAFqC,EAGrChB,QAAQ,GAAG,KAH0B,KAIpB;EACjB,MAAMiB,QAAmB,GAAG,EAA5B,CAAA;EACAF,MAAM,GAAGf,QAAQ,GAAGe,MAAM,CAACG,OAAP,EAAH,GAAsBH,MAAvC,CAAA;;AAEA,EAAA,KAAK,IAAIT,IAAT,IAAiBS,MAAjB,EAAyB;IACvB,KAAK,IAAIV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,MAAA,IAAIL,QAAJ,EAAc;QACZiB,QAAQ,CAACN,IAAT,CAAcQ,OAAO,CAACb,IAAI,GAAG,CAAR,CAArB,CAAA,CAAA;AACAA,QAAAA,IAAI,KAAK,CAAT,CAAA;AACD,OAHD,MAGO;QACLW,QAAQ,CAACN,IAAT,CAAcQ,OAAO,CAACb,IAAI,GAAG,WAAR,CAArB,CAAA,CAAA;AACAA,QAAAA,IAAI,KAAK,CAAT,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;;AAED,EAAA,OAAOW,QAAQ,CAACG,KAAT,CAAe,CAAf,EAAkBJ,aAAlB,CAAP,CAAA;AACD;;;;;"}