{"version":3,"file":"Account.cjs","sources":["../../../src/types/Account.ts"],"sourcesContent":["import { Buffer } from 'buffer';\nimport { PublicKey } from '@solana/web3.js';\nimport { SolAmount } from './Amount';\nimport {\n  createSerializerFromSolitaType,\n  deserializeAccount,\n  SolitaType,\n} from './Serializer';\nimport { AccountNotFoundError } from '@/errors';\n\nexport type AccountInfo = {\n  readonly executable: boolean;\n  readonly owner: PublicKey;\n  readonly lamports: SolAmount;\n  readonly rentEpoch?: number;\n};\n\nexport type Account<T> = AccountInfo & {\n  readonly publicKey: PublicKey;\n  readonly data: T;\n};\n\nexport type MaybeAccount<T> =\n  | (Account<T> & { readonly exists: true })\n  | { readonly publicKey: PublicKey; readonly exists: false };\n\nexport type UnparsedAccount = Account<Buffer>;\nexport type UnparsedMaybeAccount = MaybeAccount<Buffer>;\n\nexport type AccountParsingFunction<T> = {\n  (unparsedAccount: UnparsedAccount): Account<T>;\n  (unparsedAccount: UnparsedMaybeAccount): MaybeAccount<T>;\n};\n\nexport type AccountParsingAndAssertingFunction<T> = (\n  unparsedAccount: UnparsedAccount | UnparsedMaybeAccount,\n  solution?: string\n) => Account<T>;\n\nexport function getAccountParsingFunction<T>(\n  parser: SolitaType<T>\n): AccountParsingFunction<T> {\n  function parse(account: UnparsedAccount): Account<T>;\n  function parse(account: UnparsedMaybeAccount): MaybeAccount<T>;\n  function parse(\n    account: UnparsedAccount | UnparsedMaybeAccount\n  ): Account<T> | MaybeAccount<T> {\n    if ('exists' in account && !account.exists) {\n      return account;\n    }\n\n    const serializer = createSerializerFromSolitaType(parser);\n    return deserializeAccount(account, serializer);\n  }\n\n  return parse;\n}\n\nexport function getAccountParsingAndAssertingFunction<T>(\n  parser: SolitaType<T>\n): AccountParsingAndAssertingFunction<T> {\n  const parse = getAccountParsingFunction(parser);\n\n  return (\n    unparsedAccount: UnparsedAccount | UnparsedMaybeAccount,\n    solution?: string\n  ) => {\n    if ('exists' in unparsedAccount) {\n      assertAccountExists(unparsedAccount, parser.name, solution);\n    }\n\n    return parse(unparsedAccount);\n  };\n}\n\nexport function assertAccountExists<T>(\n  account: MaybeAccount<T>,\n  name?: string,\n  solution?: string\n): asserts account is Account<T> & { exists: true } {\n  if (!account.exists) {\n    throw new AccountNotFoundError(account.publicKey, name, { solution });\n  }\n}\n\nexport const toAccountInfo = (account: UnparsedAccount): AccountInfo => {\n  const { executable, owner, lamports, rentEpoch } = account;\n  return { executable, owner, lamports, rentEpoch };\n};\n"],"names":["getAccountParsingFunction","parser","parse","account","exists","serializer","createSerializerFromSolitaType","deserializeAccount","getAccountParsingAndAssertingFunction","unparsedAccount","solution","assertAccountExists","name","AccountNotFoundError","publicKey","toAccountInfo","executable","owner","lamports","rentEpoch"],"mappings":";;;;;;;AAuCO,SAASA,yBAAT,CACLC,MADK,EAEsB;EAG3B,SAASC,KAAT,CACEC,OADF,EAEgC;AAC9B,IAAA,IAAI,YAAYA,OAAZ,IAAuB,CAACA,OAAO,CAACC,MAApC,EAA4C;AAC1C,MAAA,OAAOD,OAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAME,UAAU,GAAGC,yCAA8B,CAACL,MAAD,CAAjD,CAAA;AACA,IAAA,OAAOM,6BAAkB,CAACJ,OAAD,EAAUE,UAAV,CAAzB,CAAA;AACD,GAAA;;AAED,EAAA,OAAOH,KAAP,CAAA;AACD,CAAA;AAEM,SAASM,qCAAT,CACLP,MADK,EAEkC;AACvC,EAAA,MAAMC,KAAK,GAAGF,yBAAyB,CAACC,MAAD,CAAvC,CAAA;AAEA,EAAA,OAAO,CACLQ,eADK,EAELC,QAFK,KAGF;IACH,IAAI,QAAA,IAAYD,eAAhB,EAAiC;MAC/BE,mBAAmB,CAACF,eAAD,EAAkBR,MAAM,CAACW,IAAzB,EAA+BF,QAA/B,CAAnB,CAAA;AACD,KAAA;;IAED,OAAOR,KAAK,CAACO,eAAD,CAAZ,CAAA;GARF,CAAA;AAUD,CAAA;AAEM,SAASE,mBAAT,CACLR,OADK,EAELS,IAFK,EAGLF,QAHK,EAI6C;AAClD,EAAA,IAAI,CAACP,OAAO,CAACC,MAAb,EAAqB;IACnB,MAAM,IAAIS,6BAAJ,CAAyBV,OAAO,CAACW,SAAjC,EAA4CF,IAA5C,EAAkD;AAAEF,MAAAA,QAAAA;AAAF,KAAlD,CAAN,CAAA;AACD,GAAA;AACF,CAAA;AAEYK,MAAAA,aAAa,GAAIZ,OAAD,IAA2C;EACtE,MAAM;IAAEa,UAAF;IAAcC,KAAd;IAAqBC,QAArB;AAA+BC,IAAAA,SAAAA;AAA/B,GAAA,GAA6ChB,OAAnD,CAAA;EACA,OAAO;IAAEa,UAAF;IAAcC,KAAd;IAAqBC,QAArB;AAA+BC,IAAAA,SAAAA;GAAtC,CAAA;AACD;;;;;;;"}