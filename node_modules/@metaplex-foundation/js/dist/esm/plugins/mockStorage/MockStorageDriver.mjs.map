{"version":3,"file":"MockStorageDriver.mjs","sources":["../../../../src/plugins/mockStorage/MockStorageDriver.ts"],"sourcesContent":["import { MetaplexFile, StorageDriver } from '../storageModule';\nimport { Amount, BigNumber, lamports, toBigNumber } from '@/types';\nimport { AssetNotFoundError } from '@/errors';\n\nconst DEFAULT_BASE_URL = 'https://mockstorage.example.com/';\nconst DEFAULT_COST_PER_BYTE = 1;\n\nexport type MockStorageOptions = {\n  baseUrl?: string;\n  costPerByte?: BigNumber | number;\n};\n\nexport class MockStorageDriver implements StorageDriver {\n  protected cache: Record<string, MetaplexFile> = {};\n  public readonly baseUrl: string;\n  public readonly costPerByte: BigNumber;\n\n  constructor(options?: MockStorageOptions) {\n    this.baseUrl = options?.baseUrl ?? DEFAULT_BASE_URL;\n    this.costPerByte = toBigNumber(\n      options?.costPerByte != null\n        ? options?.costPerByte\n        : DEFAULT_COST_PER_BYTE\n    );\n  }\n\n  async getUploadPrice(bytes: number): Promise<Amount> {\n    return lamports(this.costPerByte.muln(bytes));\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const uri = `${this.baseUrl}${file.uniqueName}`;\n    this.cache[uri] = file;\n\n    return uri;\n  }\n\n  async download(uri: string): Promise<MetaplexFile> {\n    const file = this.cache[uri];\n\n    if (!file) {\n      throw new AssetNotFoundError(uri);\n    }\n\n    return file;\n  }\n}\n"],"names":["DEFAULT_BASE_URL","DEFAULT_COST_PER_BYTE","MockStorageDriver","constructor","options","baseUrl","costPerByte","toBigNumber","getUploadPrice","bytes","lamports","muln","upload","file","uri","uniqueName","cache","download","AssetNotFoundError"],"mappings":";;;;;AAIA,MAAMA,gBAAgB,GAAG,kCAAzB,CAAA;AACA,MAAMC,qBAAqB,GAAG,CAA9B,CAAA;AAOO,MAAMC,iBAAN,CAAiD;EAKtDC,WAAW,CAACC,OAAD,EAA+B;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,OAAA,EAJM,EAIN,CAAA,CAAA;;AACxC,IAAA,IAAA,CAAKC,OAAL,GAAeD,OAAO,EAAEC,OAAT,IAAoBL,gBAAnC,CAAA;AACA,IAAA,IAAA,CAAKM,WAAL,GAAmBC,WAAW,CAC5BH,OAAO,EAAEE,WAAT,IAAwB,IAAxB,GACIF,OAAO,EAAEE,WADb,GAEIL,qBAHwB,CAA9B,CAAA;AAKD,GAAA;;EAEmB,MAAdO,cAAc,CAACC,KAAD,EAAiC;IACnD,OAAOC,QAAQ,CAAC,IAAKJ,CAAAA,WAAL,CAAiBK,IAAjB,CAAsBF,KAAtB,CAAD,CAAf,CAAA;AACD,GAAA;;EAEW,MAANG,MAAM,CAACC,IAAD,EAAsC;IAChD,MAAMC,GAAG,GAAI,CAAE,EAAA,IAAA,CAAKT,OAAQ,CAAEQ,EAAAA,IAAI,CAACE,UAAW,CAA9C,CAAA,CAAA;AACA,IAAA,IAAA,CAAKC,KAAL,CAAWF,GAAX,CAAA,GAAkBD,IAAlB,CAAA;AAEA,IAAA,OAAOC,GAAP,CAAA;AACD,GAAA;;EAEa,MAARG,QAAQ,CAACH,GAAD,EAAqC;AACjD,IAAA,MAAMD,IAAI,GAAG,IAAA,CAAKG,KAAL,CAAWF,GAAX,CAAb,CAAA;;IAEA,IAAI,CAACD,IAAL,EAAW;AACT,MAAA,MAAM,IAAIK,kBAAJ,CAAuBJ,GAAvB,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,OAAOD,IAAP,CAAA;AACD,GAAA;;AAjCqD;;;;"}