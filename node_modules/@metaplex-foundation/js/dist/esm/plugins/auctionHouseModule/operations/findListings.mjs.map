{"version":3,"file":"findListings.mjs","sources":["../../../../../src/plugins/auctionHouseModule/operations/findListings.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { toListingReceiptAccount } from '../accounts';\nimport { ListingReceiptGpaBuilder } from '../gpaBuilders';\nimport { AuctionHouse, LazyListing, Listing, toLazyListing } from '../models';\nimport {\n  Operation,\n  OperationHandler,\n  OperationScope,\n  useOperation,\n} from '@/types';\nimport { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'FindListingsOperation' as const;\n\n/**\n * Finds Listings by multiple criteria.\n * You can use any combination of keys.\n *\n * ```ts\n * // Find all listings in an Auction House.\n * const listings = await metaplex\n *   .auctionHouse()\n *   .findListings({ auctionHouse });\n *\n * // Find listings by seller and mint.\n * const listings = await metaplex\n *   .auctionHouse()\n *   .findListings({ auctionHouse, seller, mint });\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const findListingsOperation = useOperation<FindListingsOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type FindListingsOperation = Operation<\n  typeof Key,\n  FindListingsInput,\n  FindListingsOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type FindListingsInput = {\n  /** A model of the Auction House related to these listings. */\n  auctionHouse: AuctionHouse;\n\n  /** The address of a seller to search by. */\n  seller?: PublicKey;\n\n  /**\n   * The address of metadata to search by.\n   * Ignored when mint provided.\n   */\n  metadata?: PublicKey;\n\n  /** The address of a mint to search by. */\n  mint?: PublicKey;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type FindListingsOutput = (Listing | LazyListing)[];\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const findListingsOperationHandler: OperationHandler<FindListingsOperation> =\n  {\n    handle: async (\n      operation: FindListingsOperation,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<FindListingsOutput> => {\n      const { commitment, programs } = scope;\n      const { auctionHouse, seller, metadata, mint } = operation.input;\n      const auctionHouseProgram = metaplex.programs().getAuctionHouse(programs);\n\n      let listingQuery = new ListingReceiptGpaBuilder(\n        metaplex,\n        auctionHouseProgram.address\n      )\n        .mergeConfig({ commitment })\n        .whereAuctionHouse(auctionHouse.address);\n\n      if (seller) {\n        listingQuery = listingQuery.whereSeller(seller);\n      }\n\n      if (metadata && !mint) {\n        listingQuery = listingQuery.whereMetadata(metadata);\n      }\n\n      if (mint) {\n        listingQuery = listingQuery.whereMetadata(\n          metaplex.nfts().pdas().metadata({ mint, programs })\n        );\n      }\n\n      scope.throwIfCanceled();\n\n      return listingQuery.getAndMap((account) =>\n        toLazyListing(toListingReceiptAccount(account), auctionHouse)\n      );\n    },\n  };\n"],"names":["Key","findListingsOperation","useOperation","findListingsOperationHandler","handle","operation","metaplex","scope","commitment","programs","auctionHouse","seller","metadata","mint","input","auctionHouseProgram","getAuctionHouse","listingQuery","ListingReceiptGpaBuilder","address","mergeConfig","whereAuctionHouse","whereSeller","whereMetadata","nfts","pdas","throwIfCanceled","getAndMap","account","toLazyListing","toListingReceiptAccount"],"mappings":";;;;;AAYA;AACA;AACA;AAEA,MAAMA,GAAG,GAAG,uBAAZ,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MACaC,qBAAqB,GAAGC,YAAY,CAAwBF,GAAxB,EAA1C;AAEP;AACA;AACA;AACA;;AAkCA;AACA;AACA;AACA;AACO,MAAMG,4BAAqE,GAChF;AACEC,EAAAA,MAAM,EAAE,OACNC,SADM,EAENC,QAFM,EAGNC,KAHM,KAI0B;IAChC,MAAM;MAAEC,UAAF;AAAcC,MAAAA,QAAAA;AAAd,KAAA,GAA2BF,KAAjC,CAAA;IACA,MAAM;MAAEG,YAAF;MAAgBC,MAAhB;MAAwBC,QAAxB;AAAkCC,MAAAA,IAAAA;KAASR,GAAAA,SAAS,CAACS,KAA3D,CAAA;IACA,MAAMC,mBAAmB,GAAGT,QAAQ,CAACG,QAAT,EAAoBO,CAAAA,eAApB,CAAoCP,QAApC,CAA5B,CAAA;AAEA,IAAA,IAAIQ,YAAY,GAAG,IAAIC,wBAAJ,CACjBZ,QADiB,EAEjBS,mBAAmB,CAACI,OAFH,CAIhBC,CAAAA,WAJgB,CAIJ;AAAEZ,MAAAA,UAAAA;AAAF,KAJI,EAKhBa,iBALgB,CAKEX,YAAY,CAACS,OALf,CAAnB,CAAA;;AAOA,IAAA,IAAIR,MAAJ,EAAY;AACVM,MAAAA,YAAY,GAAGA,YAAY,CAACK,WAAb,CAAyBX,MAAzB,CAAf,CAAA;AACD,KAAA;;AAED,IAAA,IAAIC,QAAQ,IAAI,CAACC,IAAjB,EAAuB;AACrBI,MAAAA,YAAY,GAAGA,YAAY,CAACM,aAAb,CAA2BX,QAA3B,CAAf,CAAA;AACD,KAAA;;AAED,IAAA,IAAIC,IAAJ,EAAU;AACRI,MAAAA,YAAY,GAAGA,YAAY,CAACM,aAAb,CACbjB,QAAQ,CAACkB,IAAT,EAAgBC,CAAAA,IAAhB,EAAuBb,CAAAA,QAAvB,CAAgC;QAAEC,IAAF;AAAQJ,QAAAA,QAAAA;AAAR,OAAhC,CADa,CAAf,CAAA;AAGD,KAAA;;AAEDF,IAAAA,KAAK,CAACmB,eAAN,EAAA,CAAA;AAEA,IAAA,OAAOT,YAAY,CAACU,SAAb,CAAwBC,OAAD,IAC5BC,aAAa,CAACC,uBAAuB,CAACF,OAAD,CAAxB,EAAmClB,YAAnC,CADR,CAAP,CAAA;AAGD,GAAA;AApCH;;;;"}