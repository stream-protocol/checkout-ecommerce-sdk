{"version":3,"file":"updateCandyMachine.mjs","sources":["../../../../../src/plugins/candyMachineModule/operations/updateCandyMachine.ts"],"sourcesContent":["import {\n  CandyMachineData,\n  createSetAuthorityInstruction,\n  createSetCollectionInstruction,\n  createSetMintAuthorityInstruction,\n  createUpdateInstruction as createUpdateCandyMachineInstruction,\n} from '@metaplex-foundation/mpl-candy-machine-core';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { CandyGuardsSettings, DefaultCandyGuardSettings } from '../guards';\nimport {\n  CandyMachine,\n  CandyMachineConfigLineSettings,\n  CandyMachineHiddenSettings,\n  isCandyMachine,\n  toCandyMachineData,\n} from '../models';\nimport { MissingInputDataError, NoInstructionsToSendError } from '@/errors';\nimport { Metaplex } from '@/Metaplex';\nimport {\n  BigNumber,\n  Creator,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  Program,\n  PublicKey,\n  Signer,\n  toPublicKey,\n} from '@/types';\nimport {\n  assertObjectHasDefinedKeys,\n  removeUndefinedAttributes,\n  TransactionBuilder,\n  TransactionBuilderOptions,\n} from '@/utils';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'UpdateCandyMachineOperation' as const;\n\n/**\n * Updates the every aspect of an existing Candy Machine, including its\n * authorities, collection and guards (when associated with a Candy Guard).\n *\n * ```ts\n * await metaplex\n *   .candyMachines()\n *   .update({\n *     candyMachine,\n *     sellerFeeBasisPoints: 500,\n *   };\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const updateCandyMachineOperation = _updateCandyMachineOperation;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction _updateCandyMachineOperation<\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(input: UpdateCandyMachineInput<T>): UpdateCandyMachineOperation<T> {\n  return { key: Key, input };\n}\n_updateCandyMachineOperation.key = Key;\n\n/**\n * @group Operations\n * @category Types\n */\nexport type UpdateCandyMachineOperation<\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n> = Operation<typeof Key, UpdateCandyMachineInput<T>, UpdateCandyMachineOutput>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type UpdateCandyMachineInput<\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n> = {\n  /**\n   * The Candy Machine to update.\n   *\n   * This can either be a Candy Machine instance or its address.\n   * When passing its address, you will need to provide enough input\n   * so the SDK knows what to update.\n   *\n   * For instance, if you only want to update the `creators` array of the Candy Machine,\n   * you will also need to provide all other Candy Machine data such as its `symbol`,\n   * its `sellerFeeBasisPoints`, etc.\n   *\n   * That's because the program requires all data to be provided at once when updating.\n   * The SDK will raise an error if you don't provide enough data letting you know\n   * what's missing.\n   *\n   * Alternatively, if you provide a Candy Machine instance, the SDK will use its\n   * current data to fill all the gaps so you can focus on what you want to update.\n   */\n  candyMachine: PublicKey | CandyMachine<T>;\n\n  /**\n   * The address of the Candy Guard associated to the Candy Machine, if any.\n   * This is only required if `candyMachine` is provided as an address and\n   * you are trying to update the `guards` or `groups` parameters.\n   *\n   * @defaultValue `candyMachine.candyGuard?.address`\n   */\n  candyGuard?: PublicKey;\n\n  /**\n   * The Signer authorized to update the Candy Machine.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  authority?: Signer;\n\n  /**\n   * The Signer authorized to update the associated Candy Guard, if any.\n   * This is typically the same as the Candy Machine authority.\n   *\n   * @defaultValue Defaults to the `authority` parameter.\n   */\n  candyGuardAuthority?: Signer;\n\n  /**\n   * The new authority that will be allowed to manage the Candy Machine.\n   * This includes updating its data, authorities, inserting items, etc.\n   *\n   * Warning: This means the current `authority` Signer will no longer be able\n   * to manage the Candy Machine.\n   *\n   * Note that if your Candy Machine has a Candy Guard associated to it,\n   * you might want to also update the Candy Guard's authority using the\n   * `newCandyGuardAuthority` parameter.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  newAuthority?: PublicKey;\n\n  /**\n   * The new authority that will be able to mint from this Candy Machine.\n   *\n   * This must be a Signer to ensure Candy Guards are not used to mint from\n   * unexpected Candy Machines as some of its guards could have side effects.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  newMintAuthority?: Signer;\n\n  /**\n   * The new authority that will be allowed to manage the Candy Guard\n   * account associated with the Candy Machine.\n   *\n   * Warning: This means the current Candy Guard `authority` Signer will\n   * no longer be able to manage the Candy Guard account.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  newCandyGuardAuthority?: PublicKey;\n\n  /**\n   * The Collection NFT that all NFTs minted from this Candy Machine should be part of.\n   * This must include its address and the update authority as a Signer.\n   *\n   * If the `candyMachine` attribute is passed as a `PublicKey`, you will also need to\n   * provide the mint address of the current collection that will be overriden.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  collection?: {\n    /** The mint address of the collection. */\n    address: PublicKey;\n\n    /** The update authority of the collection as a Signer. */\n    updateAuthority: Signer;\n\n    /** The mint address of the current collection that will be overriden. */\n    currentCollectionAddress?: PublicKey;\n  };\n\n  /**\n   * The royalties that should be set on minted NFTs in basis points.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  sellerFeeBasisPoints?: number;\n\n  /**\n   * The total number of items availble in the Candy Machine, minted or not.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  itemsAvailable?: BigNumber;\n\n  /**\n   * Settings related to the Candy Machine's items.\n   *\n   * These can either be inserted manually within the Candy Machine or\n   * they can be infered from a set of hidden settings.\n   *\n   * - If `type` is `hidden`, the Candy Machine is using hidden settings.\n   * - If `type` is `configLines`, the Candy Machine is using config line settings.\n   *\n   * @defaultValue Defaults to not being updated.\n   *\n   * @see {@link CandyMachineHiddenSettings}\n   * @see {@link CandyMachineConfigLineSettings}\n   */\n  itemSettings?: CandyMachineHiddenSettings | CandyMachineConfigLineSettings;\n\n  /**\n   * The symbol to use when minting NFTs (e.g. \"MYPROJECT\")\n   *\n   * This can be any string up to 10 bytes and can be made optional\n   * by providing an empty string.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  symbol?: string;\n\n  /**\n   * The maximum number of editions that can be printed from the\n   * minted NFTs.\n   *\n   * For most use cases, you'd want to set this to `0` to prevent\n   * minted NFTs to be printed multiple times.\n   *\n   * Note that you cannot set this to `null` which means unlimited editions\n   * are not supported by the Candy Machine program.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  maxEditionSupply?: BigNumber;\n\n  /**\n   * Whether the minted NFTs should be mutable or not.\n   *\n   * We recommend setting this to `true` unless you have a specific reason.\n   * You can always make NFTs immutable in the future but you cannot make\n   * immutable NFTs mutable ever again.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  isMutable?: boolean;\n\n  /**\n   * Array of creators that should be set on minted NFTs.\n   *\n   * @defaultValue Defaults to not being updated.\n   *\n   * @see {@link Creator}\n   */\n  creators?: Omit<Creator, 'verified'>[];\n\n  /**\n   * The settings of all guards we wish to activate.\n   *\n   * Note that this will override the existing `guards` settings\n   * so you must provide all guards you wish to activate.\n   *\n   * Any guard not provided or set to `null` will be disabled.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  guards?: Partial<T>;\n\n  /**\n   * This parameter allows us to create multiple minting groups that have their\n   * own set of requirements â€” i.e. guards.\n   *\n   * Note that this will override the existing `groups` settings\n   * so you must provide all groups and guards you wish to activate.\n   *\n   * When groups are provided, the `guards` parameter becomes a set of default\n   * guards that will be applied to all groups. If a specific group enables\n   * a guard that is also present in the default guards, the group's guard\n   * will override the default guard.\n   *\n   * For each group, any guard not provided or set to `null` will be disabled.\n   *\n   * You may disable groups by providing an empty array `[]`.\n   *\n   * @defaultValue Defaults to not being updated.\n   */\n  groups?: { label: string; guards: Partial<T> }[];\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type UpdateCandyMachineOutput = {\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const updateCandyMachineOperationHandler: OperationHandler<UpdateCandyMachineOperation> =\n  {\n    async handle<T extends CandyGuardsSettings = DefaultCandyGuardSettings>(\n      operation: UpdateCandyMachineOperation<T>,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<UpdateCandyMachineOutput> {\n      const builder = updateCandyMachineBuilder(\n        metaplex,\n        operation.input,\n        scope\n      );\n\n      if (builder.isEmpty()) {\n        throw new NoInstructionsToSendError(Key);\n      }\n\n      return builder.sendAndConfirm(metaplex, scope.confirmOptions);\n    },\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type UpdateCandyMachineBuilderParams<\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n> = Omit<UpdateCandyMachineInput<T>, 'confirmOptions'> & {\n  /** A key to distinguish the instruction that updates the Candy Machine data. */\n  updateDataInstructionKey?: string;\n\n  /** A key to distinguish the instruction that updates the Candy Machine collection. */\n  setCollectionInstructionKey?: string;\n\n  /** A key to distinguish the instruction that updates the associated Candy Guard, if any. */\n  updateCandyGuardInstructionKey?: string;\n\n  /** A key to distinguish the instruction that updates the Candy Machine's mint authority. */\n  setMintAuthorityInstructionKey?: string;\n\n  /** A key to distinguish the instruction that updates the Candy Machine's authority. */\n  setAuthorityInstructionKey?: string;\n\n  /** A key to distinguish the instruction that updates the Candy Guard's authority. */\n  setCandyGuardAuthorityInstructionKey?: string;\n};\n\n/**\n * Updates the every aspect of an existing Candy Machine, including its\n * authorities, collection and guards (when associated with a Candy Guard).\n *\n * ```ts\n * const transactionBuilder = await metaplex\n *   .candyMachines()\n *   .builders()\n *   .update({\n *     candyMachine,\n *     sellerFeeBasisPoints: 500,\n *   });\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const updateCandyMachineBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  options: TransactionBuilderOptions = {}\n): TransactionBuilder => {\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const { authority = metaplex.identity(), candyGuardAuthority = authority } =\n    params;\n\n  return (\n    TransactionBuilder.make()\n      .setFeePayer(payer)\n\n      // Update Candy Machine data.\n      .add(\n        updateCandyMachineDataBuilder<T>(metaplex, params, authority, programs)\n      )\n\n      // Update Candy Machine collection.\n      .add(\n        updateCandyMachineCollectionBuilder<T>(\n          metaplex,\n          params,\n          authority,\n          payer,\n          programs\n        )\n      )\n\n      // Update Candy Guard's guards and groups, if any.\n      .add(\n        updateCandyGuardsBuilder<T>(\n          metaplex,\n          params,\n          candyGuardAuthority,\n          payer,\n          programs\n        )\n      )\n\n      // Update Candy Machine mint authority.\n      .add(\n        updateCandyMachineMintAuthorityBuilder<T>(\n          metaplex,\n          params,\n          authority,\n          programs\n        )\n      )\n\n      // Update Candy Machine authority.\n      .add(\n        updateCandyMachineAuthorityBuilder<T>(\n          metaplex,\n          params,\n          authority,\n          programs\n        )\n      )\n\n      // Update Candy Guard authority.\n      .add(\n        updateCandyGuardAuthorityBuilder<T>(\n          metaplex,\n          params,\n          candyGuardAuthority,\n          payer,\n          programs\n        )\n      )\n  );\n};\n\nconst updateCandyMachineDataBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  authority: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  const dataToUpdate: Partial<CandyMachine> = removeUndefinedAttributes({\n    itemsAvailable: params.itemsAvailable,\n    symbol: params.symbol,\n    sellerFeeBasisPoints: params.sellerFeeBasisPoints,\n    maxEditionSupply: params.maxEditionSupply,\n    isMutable: params.isMutable,\n    creators: params.creators,\n    itemSettings: params.itemSettings,\n  });\n\n  const candyMachineProgram = metaplex.programs().getCandyMachine(programs);\n\n  let data: CandyMachineData;\n  if (Object.keys(dataToUpdate).length === 0) {\n    return TransactionBuilder.make();\n  } else if (isCandyMachine(params.candyMachine)) {\n    data = toCandyMachineData({ ...params.candyMachine, ...dataToUpdate });\n  } else {\n    assertObjectHasDefinedKeys(\n      dataToUpdate,\n      [\n        'itemsAvailable',\n        'symbol',\n        'sellerFeeBasisPoints',\n        'maxEditionSupply',\n        'isMutable',\n        'creators',\n        'itemSettings',\n      ],\n      onMissingInputError\n    );\n    data = toCandyMachineData(dataToUpdate);\n  }\n\n  return TransactionBuilder.make().add({\n    instruction: createUpdateCandyMachineInstruction(\n      {\n        candyMachine: toPublicKey(params.candyMachine),\n        authority: authority.publicKey,\n      },\n      { data },\n      candyMachineProgram.address\n    ),\n    signers: [authority],\n    key: params.updateDataInstructionKey ?? 'updateCandyMachineData',\n  });\n};\n\nconst updateCandyMachineCollectionBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  authority: Signer,\n  payer: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  if (!params.collection) {\n    return TransactionBuilder.make();\n  }\n\n  const currentCollectionAddress =\n    params.collection.currentCollectionAddress ??\n    (isCandyMachine(params.candyMachine)\n      ? params.candyMachine.collectionMintAddress\n      : null);\n\n  if (!currentCollectionAddress) {\n    throw onMissingInputError(['collection.currentCollectionAddress']);\n  }\n\n  // Programs.\n  const tokenMetadataProgram = metaplex.programs().getTokenMetadata(programs);\n  const candyMachineProgram = metaplex.programs().getCandyMachine(programs);\n\n  // Addresses.\n  const candyMachineAddress = toPublicKey(params.candyMachine);\n  const collectionAddress = params.collection.address;\n  const collectionUpdateAuthority = params.collection.updateAuthority;\n\n  // PDAs.\n  const authorityPda = metaplex.candyMachines().pdas().authority({\n    candyMachine: candyMachineAddress,\n    programs,\n  });\n  const currentCollectionMetadata = metaplex.nfts().pdas().metadata({\n    mint: currentCollectionAddress,\n  });\n  const currentCollectionAuthorityRecord = metaplex\n    .nfts()\n    .pdas()\n    .collectionAuthorityRecord({\n      mint: currentCollectionAddress,\n      collectionAuthority: authorityPda,\n    });\n  const collectionMetadata = metaplex.nfts().pdas().metadata({\n    mint: collectionAddress,\n  });\n  const collectionMasterEdition = metaplex.nfts().pdas().masterEdition({\n    mint: collectionAddress,\n  });\n  const collectionAuthorityRecord = metaplex\n    .nfts()\n    .pdas()\n    .collectionAuthorityRecord({\n      mint: collectionAddress,\n      collectionAuthority: authorityPda,\n    });\n\n  return TransactionBuilder.make().add({\n    instruction: createSetCollectionInstruction(\n      {\n        candyMachine: candyMachineAddress,\n        authority: authority.publicKey,\n        authorityPda,\n        payer: payer.publicKey,\n        collectionMint: currentCollectionAddress,\n        collectionMetadata: currentCollectionMetadata,\n        collectionAuthorityRecord: currentCollectionAuthorityRecord,\n        newCollectionUpdateAuthority: collectionUpdateAuthority.publicKey,\n        newCollectionMetadata: collectionMetadata,\n        newCollectionMint: collectionAddress,\n        newCollectionMasterEdition: collectionMasterEdition,\n        newCollectionAuthorityRecord: collectionAuthorityRecord,\n        tokenMetadataProgram: tokenMetadataProgram.address,\n      },\n      candyMachineProgram.address\n    ),\n    signers: [authority, payer, collectionUpdateAuthority],\n    key: params.setCollectionInstructionKey ?? 'setCandyMachineCollection',\n  });\n};\n\nconst updateCandyGuardsBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  candyGuardAuthority: Signer,\n  payer: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  const guardsToUpdate: {\n    candyGuard?: PublicKey;\n    guards?: Partial<T>;\n    groups?: { label: string; guards: Partial<T> }[];\n  } = removeUndefinedAttributes({\n    candyGuard: params.candyGuard,\n    guards: params.guards,\n    groups: params.groups,\n  });\n\n  let args: {\n    candyGuard: PublicKey;\n    guards: Partial<T>;\n    groups: { label: string; guards: Partial<T> }[];\n  };\n\n  if (Object.keys(guardsToUpdate).length === 0) {\n    return TransactionBuilder.make();\n  }\n\n  if (\n    isCandyMachine<T>(params.candyMachine) &&\n    params.candyMachine.candyGuard\n  ) {\n    args = {\n      candyGuard: params.candyMachine.candyGuard.address,\n      guards: params.candyMachine.candyGuard.guards,\n      groups: params.candyMachine.candyGuard.groups,\n      ...guardsToUpdate,\n    };\n  } else {\n    assertObjectHasDefinedKeys(\n      guardsToUpdate,\n      ['candyGuard', 'guards', 'groups'],\n      onMissingInputError\n    );\n    args = guardsToUpdate;\n  }\n\n  return metaplex\n    .candyMachines()\n    .builders()\n    .updateCandyGuard<T>(\n      {\n        candyGuard: args.candyGuard,\n        guards: args.guards,\n        groups: args.groups,\n        authority: candyGuardAuthority,\n        updateInstructionKey:\n          params.updateCandyGuardInstructionKey ?? 'updateCandyGuard',\n      },\n      { payer, programs }\n    );\n};\n\nconst updateCandyMachineMintAuthorityBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  authority: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  if (!params.newMintAuthority) {\n    return TransactionBuilder.make();\n  }\n\n  const candyMachineProgram = metaplex.programs().getCandyMachine(programs);\n\n  return TransactionBuilder.make().add({\n    instruction: createSetMintAuthorityInstruction(\n      {\n        candyMachine: toPublicKey(params.candyMachine),\n        authority: authority.publicKey,\n        mintAuthority: params.newMintAuthority.publicKey,\n      },\n      candyMachineProgram.address\n    ),\n    signers: [authority, params.newMintAuthority],\n    key: params.setAuthorityInstructionKey ?? 'setCandyMachineAuthority',\n  });\n};\n\nconst updateCandyMachineAuthorityBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  authority: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  if (!params.newAuthority) {\n    return TransactionBuilder.make();\n  }\n\n  const candyMachineProgram = metaplex.programs().getCandyMachine(programs);\n\n  return TransactionBuilder.make().add({\n    instruction: createSetAuthorityInstruction(\n      {\n        candyMachine: toPublicKey(params.candyMachine),\n        authority: authority.publicKey,\n      },\n      { newAuthority: params.newAuthority },\n      candyMachineProgram.address\n    ),\n    signers: [authority],\n    key: params.setAuthorityInstructionKey ?? 'setCandyMachineAuthority',\n  });\n};\n\nconst updateCandyGuardAuthorityBuilder = <\n  T extends CandyGuardsSettings = DefaultCandyGuardSettings\n>(\n  metaplex: Metaplex,\n  params: UpdateCandyMachineBuilderParams<T>,\n  candyGuardAuthority: Signer,\n  payer: Signer,\n  programs?: Program[]\n): TransactionBuilder => {\n  if (!params.newCandyGuardAuthority) {\n    return TransactionBuilder.make();\n  }\n\n  const candyGuardAddress =\n    params.candyGuard ??\n    (isCandyMachine<T>(params.candyMachine) && params.candyMachine.candyGuard\n      ? params.candyMachine.candyGuard.address\n      : null);\n\n  if (!candyGuardAddress) {\n    throw onMissingInputError(['candyGuard']);\n  }\n\n  return TransactionBuilder.make().add(\n    metaplex.candyMachines().builders().updateCandyGuardAuthority(\n      {\n        candyGuard: candyGuardAddress,\n        authority: candyGuardAuthority,\n        newAuthority: params.newCandyGuardAuthority,\n        instructionKey: params.setCandyGuardAuthorityInstructionKey,\n      },\n      { payer, programs }\n    )\n  );\n};\n\nconst onMissingInputError = (missingKeys: string[]) =>\n  new MissingInputDataError(missingKeys, {\n    problem:\n      'When passing the Candy Machine as a `PublicKey` instead of a Candy Machine model ' +\n      'the SDK cannot rely on current data to fill the gaps within the provided input.',\n    solutionSuffix:\n      ' Alternatively, you can pass the Candy Machine model instead.',\n  });\n"],"names":["Key","updateCandyMachineOperation","_updateCandyMachineOperation","input","key","updateCandyMachineOperationHandler","handle","operation","metaplex","scope","builder","updateCandyMachineBuilder","isEmpty","NoInstructionsToSendError","sendAndConfirm","confirmOptions","params","options","programs","payer","rpc","getDefaultFeePayer","authority","identity","candyGuardAuthority","TransactionBuilder","make","setFeePayer","add","updateCandyMachineDataBuilder","updateCandyMachineCollectionBuilder","updateCandyGuardsBuilder","updateCandyMachineMintAuthorityBuilder","updateCandyMachineAuthorityBuilder","updateCandyGuardAuthorityBuilder","dataToUpdate","removeUndefinedAttributes","itemsAvailable","symbol","sellerFeeBasisPoints","maxEditionSupply","isMutable","creators","itemSettings","candyMachineProgram","getCandyMachine","data","Object","keys","length","isCandyMachine","candyMachine","toCandyMachineData","assertObjectHasDefinedKeys","onMissingInputError","instruction","createUpdateCandyMachineInstruction","toPublicKey","publicKey","address","signers","updateDataInstructionKey","collection","currentCollectionAddress","collectionMintAddress","tokenMetadataProgram","getTokenMetadata","candyMachineAddress","collectionAddress","collectionUpdateAuthority","updateAuthority","authorityPda","candyMachines","pdas","currentCollectionMetadata","nfts","metadata","mint","currentCollectionAuthorityRecord","collectionAuthorityRecord","collectionAuthority","collectionMetadata","collectionMasterEdition","masterEdition","createSetCollectionInstruction","collectionMint","newCollectionUpdateAuthority","newCollectionMetadata","newCollectionMint","newCollectionMasterEdition","newCollectionAuthorityRecord","setCollectionInstructionKey","guardsToUpdate","candyGuard","guards","groups","args","builders","updateCandyGuard","updateInstructionKey","updateCandyGuardInstructionKey","newMintAuthority","createSetMintAuthorityInstruction","mintAuthority","setAuthorityInstructionKey","newAuthority","createSetAuthorityInstruction","newCandyGuardAuthority","candyGuardAddress","updateCandyGuardAuthority","instructionKey","setCandyGuardAuthorityInstructionKey","missingKeys","MissingInputDataError","problem","solutionSuffix"],"mappings":"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"}