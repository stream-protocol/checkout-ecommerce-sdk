{"version":3,"file":"mintFromCandyMachine.mjs","sources":["../../../../../src/plugins/candyMachineModule/operations/mintFromCandyMachine.ts"],"sourcesContent":["import { createMintInstruction as createMintFromGuardInstruction } from '@metaplex-foundation/mpl-candy-guard';\nimport { createMintInstruction as createMintFromMachineInstruction } from '@metaplex-foundation/mpl-candy-machine-core';\nimport {\n  Keypair,\n  SYSVAR_INSTRUCTIONS_PUBKEY,\n  SYSVAR_SLOT_HASHES_PUBKEY,\n  TransactionInstruction,\n} from '@solana/web3.js';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { CandyMachineBotTaxError } from '../errors';\nimport {\n  CandyGuardsMintSettings,\n  CandyGuardsSettings,\n  DefaultCandyGuardMintSettings,\n  DefaultCandyGuardSettings,\n} from '../guards';\nimport { CandyMachine } from '../models';\nimport { Option, TransactionBuilder, TransactionBuilderOptions } from '@/utils';\nimport {\n  makeConfirmOptionsFinalizedOnMainnet,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  PublicKey,\n  Signer,\n  token as tokenAmount,\n} from '@/types';\nimport { NftWithToken } from '@/plugins/nftModule';\nimport { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'MintFromCandyMachineOperation' as const;\n\n/**\n * Mints the next NFT from a given candy machine.\n *\n * ```ts\n * const { nft } = await metaplex\n *   .candyMachines()\n *   .mint({\n *     candyMachine,\n *     collectionUpdateAuthority,\n *   };\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const mintFromCandyMachineOperation = _mintFromCandyMachineOperation;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction _mintFromCandyMachineOperation<\n  Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n  MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n>(\n  input: MintFromCandyMachineInput<Settings, MintSettings>\n): MintFromCandyMachineOperation<Settings, MintSettings> {\n  return { key: Key, input };\n}\n_mintFromCandyMachineOperation.key = Key;\n\n/**\n * @group Operations\n * @category Types\n */\nexport type MintFromCandyMachineOperation<\n  Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n  MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n> = Operation<\n  typeof Key,\n  MintFromCandyMachineInput<Settings, MintSettings>,\n  MintFromCandyMachineOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type MintFromCandyMachineInput<\n  Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n  MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n> = {\n  /**\n   * The Candy Machine to mint from.\n   * We only need a subset of the `CandyMachine` model but we\n   * need enough information regarding its settings to know how\n   * to mint from it.\n   *\n   * This includes its address, the address of its Collection NFT and,\n   * optionally, the Candy Guard account associated with it.\n   */\n  candyMachine: Pick<\n    CandyMachine<Settings>,\n    'address' | 'collectionMintAddress' | 'candyGuard'\n  >;\n\n  /**\n   * The address of the update authority of the Collection NFT\n   * that is being assigned to each minted NFT.\n   */\n  collectionUpdateAuthority: PublicKey;\n\n  /**\n   * The authority that is allowed to mint NFTs from the Candy Machine.\n   *\n   * @defaultValue\n   * `metaplex.identity()` if the Candy Machine has no associated Candy Guard.\n   * Otherwise, this parameter will be ignored.\n   */\n  mintAuthority?: Signer;\n\n  /**\n   * The mint account to create as a Signer.\n   * This expects a brand new Keypair with no associated account.\n   *\n   * @defaultValue `Keypair.generate()`\n   */\n  mint?: Signer;\n\n  /**\n   * The owner of the minted NFT.\n   *\n   * Defaults to the wallet that is paying for it, i.e. `payer`.\n   *\n   * @defaultValue `payer.publicKey`\n   */\n  owner?: PublicKey;\n\n  /**\n   * The new token account to create as a Signer.\n   *\n   * This property would typically be ignored as, by default, it will create a\n   * associated token account from the `owner` and `mint` properties.\n   *\n   * When provided, the `owner` property will be ignored.\n   *\n   * @defaultValue associated token address of `owner` and `mint`.\n   */\n  token?: Signer;\n\n  /**\n   * The label of the group to mint from.\n   *\n   * If groups are configured on the Candy Machine,\n   * you must specify a group label to mint from.\n   *\n   * When set to `null` it will mint using the default\n   * guards, provided no groups are configured.\n   *\n   * @defaultValue `null`\n   */\n  group?: Option<string>;\n\n  /**\n   * Guard-specific data required to mint from the Candy Machine.\n   *\n   * Some guards require additional data to be provided at mint time.\n   * For instance, the `allowList` guard will require a Merkle proof\n   * ensuring the minting address is allowed to mint.\n   *\n   * You only need to provide configuration data for the guards\n   * that are set up within the group your are minting from.\n   *\n   * @defaultValue `{}`\n   */\n  guards?: Partial<MintSettings>;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type MintFromCandyMachineOutput = {\n  /** The minted NFT. */\n  nft: NftWithToken;\n\n  /** The mint account of the minted NFT as a Signer. */\n  mintSigner: Signer;\n\n  /** The address of the minted NFT's token account. */\n  tokenAddress: PublicKey;\n\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const mintFromCandyMachineOperationHandler: OperationHandler<MintFromCandyMachineOperation> =\n  {\n    async handle<\n      Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n      MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n    >(\n      operation: MintFromCandyMachineOperation<Settings, MintSettings>,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<MintFromCandyMachineOutput> {\n      const builder = await mintFromCandyMachineBuilder<Settings, MintSettings>(\n        metaplex,\n        operation.input,\n        scope\n      );\n      scope.throwIfCanceled();\n\n      const confirmOptions = makeConfirmOptionsFinalizedOnMainnet(\n        metaplex,\n        scope.confirmOptions\n      );\n      const output = await builder.sendAndConfirm(metaplex, confirmOptions);\n      scope.throwIfCanceled();\n\n      let nft: NftWithToken;\n      try {\n        nft = (await metaplex.nfts().findByMint(\n          {\n            mintAddress: output.mintSigner.publicKey,\n            tokenAddress: output.tokenAddress,\n          },\n          scope\n        )) as NftWithToken;\n      } catch (error) {\n        const { candyGuard } = operation.input.candyMachine;\n        if (!candyGuard) {\n          throw error;\n        }\n\n        const activeGuards = metaplex\n          .candyMachines()\n          .guards()\n          .resolveGroupSettings(\n            candyGuard.guards,\n            candyGuard.groups,\n            operation.input.group ?? null\n          );\n\n        if (!('botTax' in activeGuards)) {\n          throw error;\n        }\n\n        throw new CandyMachineBotTaxError(\n          metaplex.rpc().getSolanaExporerUrl(output.response.signature),\n          error as Error\n        );\n      }\n\n      return { nft, ...output };\n    },\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type MintFromCandyMachineBuilderParams<\n  Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n  MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n> = Omit<\n  MintFromCandyMachineInput<Settings, MintSettings>,\n  'confirmOptions'\n> & {\n  /** A key to distinguish the instruction that creates the mint account of the NFT. */\n  createMintAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that initializes the mint account of the NFT. */\n  initializeMintInstructionKey?: string;\n\n  /** A key to distinguish the instruction that creates the associated token account of the NFT. */\n  createAssociatedTokenAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that creates the token account of the NFT. */\n  createTokenAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that initializes the token account of the NFT. */\n  initializeTokenInstructionKey?: string;\n\n  /** A key to distinguish the instruction that mints the one token. */\n  mintTokensInstructionKey?: string;\n\n  /** A key to distinguish the instruction that mints from the Candy Machine. */\n  mintFromCandyMachineInstructionKey?: string;\n};\n\n/**\n * @group Transaction Builders\n * @category Contexts\n */\nexport type MintFromCandyMachineBuilderContext = Omit<\n  MintFromCandyMachineOutput,\n  'response' | 'nft'\n>;\n\n/**\n * Mints the next NFT from a given candy machine.\n *\n * ```ts\n * const transactionBuilder = await metaplex\n *   .candyMachines()\n *   .builders()\n *   .mint({\n *     candyMachine,\n *     collectionUpdateAuthority,\n *   });\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const mintFromCandyMachineBuilder = async <\n  Settings extends CandyGuardsSettings = DefaultCandyGuardSettings,\n  MintSettings extends CandyGuardsMintSettings = DefaultCandyGuardMintSettings\n>(\n  metaplex: Metaplex,\n  params: MintFromCandyMachineBuilderParams<Settings, MintSettings>,\n  options: TransactionBuilderOptions = {}\n): Promise<TransactionBuilder<MintFromCandyMachineBuilderContext>> => {\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const {\n    candyMachine,\n    collectionUpdateAuthority,\n    mintAuthority = metaplex.identity(),\n    mint = Keypair.generate(),\n    owner = payer.publicKey,\n    group = null,\n    guards = {},\n    token,\n  } = params;\n\n  // Programs.\n  const candyMachineProgram = metaplex.programs().getCandyMachine(programs);\n  const candyGuardProgram = metaplex.programs().getCandyGuard(programs);\n  const tokenMetadataProgram = metaplex.programs().getTokenMetadata(programs);\n  const tokenProgram = metaplex.programs().getToken(programs);\n  const systemProgram = metaplex.programs().getSystem(programs);\n\n  // PDAs.\n  const authorityPda = metaplex.candyMachines().pdas().authority({\n    candyMachine: candyMachine.address,\n    programs,\n  });\n  const nftMetadata = metaplex.nfts().pdas().metadata({\n    mint: mint.publicKey,\n    programs,\n  });\n  const nftMasterEdition = metaplex.nfts().pdas().masterEdition({\n    mint: mint.publicKey,\n    programs,\n  });\n  const collectionMetadata = metaplex.nfts().pdas().metadata({\n    mint: candyMachine.collectionMintAddress,\n    programs,\n  });\n  const collectionMasterEdition = metaplex.nfts().pdas().masterEdition({\n    mint: candyMachine.collectionMintAddress,\n    programs,\n  });\n  const collectionAuthorityRecord = metaplex\n    .nfts()\n    .pdas()\n    .collectionAuthorityRecord({\n      mint: candyMachine.collectionMintAddress,\n      collectionAuthority: authorityPda,\n      programs,\n    });\n\n  // Transaction Builder that prepares the mint and token accounts.\n  const tokenWithMintBuilder = await metaplex\n    .tokens()\n    .builders()\n    .createTokenWithMint(\n      {\n        decimals: 0,\n        initialSupply: tokenAmount(1),\n        mint,\n        mintAuthority: payer,\n        freezeAuthority: payer.publicKey,\n        owner,\n        token,\n        createMintAccountInstructionKey: params.createMintAccountInstructionKey,\n        initializeMintInstructionKey: params.initializeMintInstructionKey,\n        createAssociatedTokenAccountInstructionKey:\n          params.createAssociatedTokenAccountInstructionKey,\n        createTokenAccountInstructionKey:\n          params.createTokenAccountInstructionKey,\n        initializeTokenInstructionKey: params.initializeTokenInstructionKey,\n        mintTokensInstructionKey: params.mintTokensInstructionKey,\n      },\n      { payer, programs }\n    );\n  const { tokenAddress } = tokenWithMintBuilder.getContext();\n\n  // Shared mint accounts\n  const sharedMintAccounts = {\n    candyMachine: candyMachine.address,\n    payer: payer.publicKey,\n    nftMetadata,\n    nftMint: mint.publicKey,\n    nftMintAuthority: payer.publicKey,\n    nftMasterEdition,\n    collectionAuthorityRecord,\n    collectionMint: candyMachine.collectionMintAddress,\n    collectionMetadata,\n    collectionMasterEdition,\n    collectionUpdateAuthority,\n    candyMachineProgram: candyMachineProgram.address,\n    tokenMetadataProgram: tokenMetadataProgram.address,\n    tokenProgram: tokenProgram.address,\n    systemProgram: systemProgram.address,\n    recentSlothashes: SYSVAR_SLOT_HASHES_PUBKEY,\n    instructionSysvarAccount: SYSVAR_INSTRUCTIONS_PUBKEY,\n  };\n\n  // Mint instruction.\n  let mintNftInstruction: TransactionInstruction;\n  let mintNftSigners: Signer[];\n  if (!!candyMachine.candyGuard) {\n    const { candyGuard } = candyMachine;\n    const guardClient = metaplex.candyMachines().guards();\n    const parsedMintSettings = guardClient.parseMintSettings(\n      candyMachine.address,\n      candyGuard,\n      owner,\n      payer,\n      mint,\n      guards,\n      group,\n      programs\n    );\n\n    mintNftSigners = [payer, mint, ...parsedMintSettings.signers];\n    mintNftInstruction = createMintFromGuardInstruction(\n      {\n        ...sharedMintAccounts,\n        candyGuard: candyMachine.candyGuard.address,\n        candyMachineAuthorityPda: authorityPda,\n      },\n      {\n        mintArgs: parsedMintSettings.arguments,\n        label: group,\n      },\n      candyGuardProgram.address\n    );\n    mintNftInstruction.keys.push(...parsedMintSettings.accountMetas);\n  } else {\n    mintNftSigners = [payer, mint, mintAuthority];\n    mintNftInstruction = createMintFromMachineInstruction(\n      {\n        ...sharedMintAccounts,\n        authorityPda,\n        mintAuthority: mintAuthority.publicKey,\n      },\n      candyMachineProgram.address\n    );\n  }\n\n  return (\n    TransactionBuilder.make<MintFromCandyMachineBuilderContext>()\n      .setFeePayer(payer)\n      .setContext({ tokenAddress, mintSigner: mint })\n\n      // Create token and mint accounts.\n      .add(tokenWithMintBuilder)\n\n      // Mint the new NFT.\n      .add({\n        instruction: mintNftInstruction,\n        signers: mintNftSigners,\n        key: params.mintFromCandyMachineInstructionKey ?? 'mintNft',\n      })\n  );\n};\n"],"names":["Key","mintFromCandyMachineOperation","_mintFromCandyMachineOperation","input","key","mintFromCandyMachineOperationHandler","handle","operation","metaplex","scope","builder","mintFromCandyMachineBuilder","throwIfCanceled","confirmOptions","makeConfirmOptionsFinalizedOnMainnet","output","sendAndConfirm","nft","nfts","findByMint","mintAddress","mintSigner","publicKey","tokenAddress","error","candyGuard","candyMachine","activeGuards","candyMachines","guards","resolveGroupSettings","groups","group","CandyMachineBotTaxError","rpc","getSolanaExporerUrl","response","signature","params","options","programs","payer","getDefaultFeePayer","collectionUpdateAuthority","mintAuthority","identity","mint","Keypair","generate","owner","token","candyMachineProgram","getCandyMachine","candyGuardProgram","getCandyGuard","tokenMetadataProgram","getTokenMetadata","tokenProgram","getToken","systemProgram","getSystem","authorityPda","pdas","authority","address","nftMetadata","metadata","nftMasterEdition","masterEdition","collectionMetadata","collectionMintAddress","collectionMasterEdition","collectionAuthorityRecord","collectionAuthority","tokenWithMintBuilder","tokens","builders","createTokenWithMint","decimals","initialSupply","tokenAmount","freezeAuthority","createMintAccountInstructionKey","initializeMintInstructionKey","createAssociatedTokenAccountInstructionKey","createTokenAccountInstructionKey","initializeTokenInstructionKey","mintTokensInstructionKey","getContext","sharedMintAccounts","nftMint","nftMintAuthority","collectionMint","recentSlothashes","SYSVAR_SLOT_HASHES_PUBKEY","instructionSysvarAccount","SYSVAR_INSTRUCTIONS_PUBKEY","mintNftInstruction","mintNftSigners","guardClient","parsedMintSettings","parseMintSettings","signers","createMintFromGuardInstruction","candyMachineAuthorityPda","mintArgs","arguments","label","keys","push","accountMetas","createMintFromMachineInstruction","TransactionBuilder","make","setFeePayer","setContext","add","instruction","mintFromCandyMachineInstructionKey"],"mappings":"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"}