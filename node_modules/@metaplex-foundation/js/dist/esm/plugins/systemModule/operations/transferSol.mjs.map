{"version":3,"file":"transferSol.mjs","sources":["../../../../../src/plugins/systemModule/operations/transferSol.ts"],"sourcesContent":["import { PublicKey, SystemProgram } from '@solana/web3.js';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport type { Metaplex } from '@/Metaplex';\nimport {\n  assertSol,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  Signer,\n  SolAmount,\n  useOperation,\n} from '@/types';\nimport { TransactionBuilder, TransactionBuilderOptions } from '@/utils';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'TransferSolOperation' as const;\n\n/**\n * Transfers some SOL from one account to another.\n *\n * ```ts\n * await metaplex\n *   .system()\n *   .transferSol({\n *     to: new PublicKey(\"...\"),\n *     amount: sol(1.5),\n *   };\n * ````\n *\n * @group Operations\n * @category Constructors\n */\nexport const transferSolOperation = useOperation<TransferSolOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type TransferSolOperation = Operation<\n  typeof Key,\n  TransferSolInput,\n  TransferSolOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type TransferSolInput = {\n  /**\n   * The account that sends the SOLs as a Signer.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  from?: Signer;\n\n  /** The address of the account that receives the SOLs. */\n  to: PublicKey;\n\n  /** The amount of SOLs to send. */\n  amount: SolAmount;\n\n  /**\n   * Base public key to use to derive the funding account address.\n   *\n   * @defaultValue Defaults to not being used.\n   */\n  basePubkey?: PublicKey;\n\n  /**\n   * Seed to use to derive the funding account address.\n   *\n   * @defaultValue Defaults to not being used.\n   */\n  seed?: string;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type TransferSolOutput = {\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const transferSolOperationHandler: OperationHandler<TransferSolOperation> =\n  {\n    async handle(\n      operation: TransferSolOperation,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<TransferSolOutput> {\n      const builder = transferSolBuilder(metaplex, operation.input, scope);\n      return builder.sendAndConfirm(metaplex, scope.confirmOptions);\n    },\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type TransferSolBuilderParams = Omit<\n  TransferSolInput,\n  'confirmOptions'\n> & {\n  /** A key to distinguish the instruction that transfers some SOL. */\n  instructionKey?: string;\n};\n\n/**\n * Transfers some SOL from one account to another.\n *\n * ```ts\n * const transactionBuilder = metaplex\n *   .system()\n *   .builders()\n *   .transferSol({\n *     to: new PublicKey(\"...\"),\n *     amount: sol(1.5),\n *   });\n * ````\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const transferSolBuilder = (\n  metaplex: Metaplex,\n  params: TransferSolBuilderParams,\n  options: TransactionBuilderOptions = {}\n): TransactionBuilder => {\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const { from = metaplex.identity(), to, amount, basePubkey, seed } = params;\n\n  assertSol(amount);\n\n  return TransactionBuilder.make()\n    .setFeePayer(payer)\n    .add({\n      instruction: SystemProgram.transfer({\n        fromPubkey: from.publicKey,\n        toPubkey: to,\n        lamports: amount.basisPoints.toNumber(),\n        ...(basePubkey ? { basePubkey, seed } : {}),\n        programId: metaplex.programs().getSystem(programs).address,\n      }),\n      signers: [from],\n      key: params.instructionKey ?? 'transferSol',\n    });\n};\n"],"names":["Key","transferSolOperation","useOperation","transferSolOperationHandler","handle","operation","metaplex","scope","builder","transferSolBuilder","input","sendAndConfirm","confirmOptions","params","options","programs","payer","rpc","getDefaultFeePayer","from","identity","to","amount","basePubkey","seed","assertSol","TransactionBuilder","make","setFeePayer","add","instruction","SystemProgram","transfer","fromPubkey","publicKey","toPubkey","lamports","basisPoints","toNumber","programId","getSystem","address","signers","key","instructionKey"],"mappings":";;;;;AAeA;AACA;;AAEA,MAAMA,GAAG,GAAG,sBAAZ,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MACaC,oBAAoB,GAAGC,YAAY,CAAuBF,GAAvB,EAAzC;AAEP;AACA;AACA;AACA;;AAiDA;AACA;AACA;AACA;AACO,MAAMG,2BAAmE,GAC9E;AACE,EAAA,MAAMC,MAAN,CACEC,SADF,EAEEC,QAFF,EAGEC,KAHF,EAI8B;IAC5B,MAAMC,OAAO,GAAGC,kBAAkB,CAACH,QAAD,EAAWD,SAAS,CAACK,KAArB,EAA4BH,KAA5B,CAAlC,CAAA;IACA,OAAOC,OAAO,CAACG,cAAR,CAAuBL,QAAvB,EAAiCC,KAAK,CAACK,cAAvC,CAAP,CAAA;AACD,GAAA;;AARH;AAYF;AACA;;AAEA;AACA;AACA;AACA;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMH,kBAAkB,GAAG,CAChCH,QADgC,EAEhCO,MAFgC,EAGhCC,OAAkC,GAAG,EAHL,KAIT;EACvB,MAAM;IAAEC,QAAF;AAAYC,IAAAA,KAAK,GAAGV,QAAQ,CAACW,GAAT,GAAeC,kBAAf,EAAA;AAApB,GAAA,GAA4DJ,OAAlE,CAAA;EACA,MAAM;AAAEK,IAAAA,IAAI,GAAGb,QAAQ,CAACc,QAAT,EAAT;IAA8BC,EAA9B;IAAkCC,MAAlC;IAA0CC,UAA1C;AAAsDC,IAAAA,IAAAA;AAAtD,GAAA,GAA+DX,MAArE,CAAA;EAEAY,SAAS,CAACH,MAAD,CAAT,CAAA;EAEA,OAAOI,kBAAkB,CAACC,IAAnB,EAAA,CACJC,WADI,CACQZ,KADR,CAEJa,CAAAA,GAFI,CAEA;AACHC,IAAAA,WAAW,EAAEC,aAAa,CAACC,QAAd,CAAuB;MAClCC,UAAU,EAAEd,IAAI,CAACe,SADiB;AAElCC,MAAAA,QAAQ,EAAEd,EAFwB;AAGlCe,MAAAA,QAAQ,EAAEd,MAAM,CAACe,WAAP,CAAmBC,QAAnB,EAHwB;AAIlC,MAAA,IAAIf,UAAU,GAAG;QAAEA,UAAF;AAAcC,QAAAA,IAAAA;OAAjB,GAA0B,EAAxC,CAJkC;MAKlCe,SAAS,EAAEjC,QAAQ,CAACS,QAAT,GAAoByB,SAApB,CAA8BzB,QAA9B,CAAwC0B,CAAAA,OAAAA;AALjB,KAAvB,CADV;IAQHC,OAAO,EAAE,CAACvB,IAAD,CARN;AASHwB,IAAAA,GAAG,EAAE9B,MAAM,CAAC+B,cAAP,IAAyB,aAAA;AAT3B,GAFA,CAAP,CAAA;AAaD;;;;"}