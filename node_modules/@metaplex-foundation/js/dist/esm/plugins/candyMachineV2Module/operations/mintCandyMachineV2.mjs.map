{"version":3,"file":"mintCandyMachineV2.mjs","sources":["../../../../../src/plugins/candyMachineV2Module/operations/mintCandyMachineV2.ts"],"sourcesContent":["import {\n  createMintNftInstruction,\n  createSetCollectionDuringMintInstruction,\n} from '@metaplex-foundation/mpl-candy-machine';\nimport {\n  Keypair,\n  PublicKey,\n  SYSVAR_CLOCK_PUBKEY,\n  SYSVAR_INSTRUCTIONS_PUBKEY,\n  SYSVAR_SLOT_HASHES_PUBKEY,\n} from '@solana/web3.js';\nimport { NftWithToken } from '../../nftModule';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { parseCandyMachineV2CollectionAccount } from '../accounts';\nimport { assertCanMintCandyMachineV2 } from '../asserts';\nimport { CandyMachineV2BotTaxError } from '../errors';\nimport { CandyMachineV2 } from '../models';\nimport {\n  findCandyMachineV2CollectionPda,\n  findCandyMachineV2CreatorPda,\n} from '../pdas';\nimport { TransactionBuilder, TransactionBuilderOptions } from '@/utils';\nimport {\n  assertAccountExists,\n  makeConfirmOptionsFinalizedOnMainnet,\n  Operation,\n  OperationHandler,\n  OperationScope,\n  Signer,\n  token,\n  useOperation,\n} from '@/types';\nimport { Metaplex } from '@/Metaplex';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'MintCandyMachineV2Operation' as const;\n\n/**\n * Mint an NFT from an existing Candy Machine.\n *\n * ```ts\n * const { nft } = await metaplex\n *   .candyMachinesV2()\n *   .mint({ candyMachine };\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const mintCandyMachineV2Operation =\n  useOperation<MintCandyMachineV2Operation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type MintCandyMachineV2Operation = Operation<\n  typeof Key,\n  MintCandyMachineV2Input,\n  MintCandyMachineV2Output\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\nexport type MintCandyMachineV2Input = {\n  /**\n   * The Candy Machine to mint from.\n   * We only need a subset of the `CandyMachine` model but we\n   * need enough information regarding its settings to know how\n   * to mint from it.\n   *\n   * This includes, its wallet address, its item statistics, it live date,\n   * its whitelist settings, etc.\n   */\n  candyMachine: Pick<\n    CandyMachineV2,\n    | 'address'\n    | 'walletAddress'\n    | 'authorityAddress'\n    | 'tokenMintAddress'\n    | 'itemsRemaining'\n    | 'itemsAvailable'\n    | 'itemsMinted'\n    | 'whitelistMintSettings'\n    | 'goLiveDate'\n    | 'endSettings'\n  >;\n\n  /**\n   * The mint account to create as a Signer.\n   * This expects a brand new Keypair with no associated account.\n   *\n   * @defaultValue `Keypair.generate()`\n   */\n  newMint?: Signer;\n\n  /**\n   * The owner of the minted NFT.\n   *\n   * @defaultValue `metaplex.identity().publicKey`\n   */\n  newOwner?: PublicKey;\n\n  /**\n   * The new token account to create as a Signer.\n   *\n   * This property would typically be ignored as, by default, it will create a\n   * associated token account from the `newOwner` and `newMint` properties.\n   *\n   * When provided, the `newOwner` property will be ignored.\n   *\n   * @defaultValue associated token address of `newOwner` and `newMint`.\n   */\n  newToken?: Signer;\n\n  /**\n   * The token account that should pay for the minted NFT.\n   *\n   * This is only relevant when the Candy Machine uses a mint treasury\n   * (i.e. payments are made using SPL tokens and not SOL).\n   *\n   * @defaultValue associated token address of `payer` and\n   * `candyMachine.tokenMintAddress`.\n   */\n  payerToken?: PublicKey;\n\n  /**\n   * The token account that contains whitelist tokens.\n   *\n   * This is only relevant when the Candy Machine uses\n   * whitelist settings.\n   *\n   * @defaultValue associated token address of `payer` and\n   * `candyMachine.whitelistMintSettings.mint`.\n   */\n  whitelistToken?: PublicKey; // Defaults to associated token.\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type MintCandyMachineV2Output = {\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n\n  /** The minted NFT. */\n  nft: NftWithToken;\n\n  /** The mint account of the minted NFT as a Signer. */\n  mintSigner: Signer;\n\n  /** The token account's address of the minted NFT. */\n  tokenAddress: PublicKey;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const mintCandyMachineV2OperationHandler: OperationHandler<MintCandyMachineV2Operation> =\n  {\n    async handle(\n      operation: MintCandyMachineV2Operation,\n      metaplex: Metaplex,\n      scope: OperationScope\n    ): Promise<MintCandyMachineV2Output> {\n      assertCanMintCandyMachineV2(operation.input.candyMachine, scope.payer);\n\n      const builder = await mintCandyMachineV2Builder(\n        metaplex,\n        operation.input,\n        scope\n      );\n      scope.throwIfCanceled();\n\n      const confirmOptions = makeConfirmOptionsFinalizedOnMainnet(\n        metaplex,\n        scope.confirmOptions\n      );\n      const output = await builder.sendAndConfirm(metaplex, confirmOptions);\n      scope.throwIfCanceled();\n\n      let nft: NftWithToken;\n      try {\n        nft = (await metaplex.nfts().findByMint(\n          {\n            mintAddress: output.mintSigner.publicKey,\n            tokenAddress: output.tokenAddress,\n          },\n          scope\n        )) as NftWithToken;\n      } catch (error) {\n        throw new CandyMachineV2BotTaxError(\n          metaplex.rpc().getSolanaExporerUrl(output.response.signature),\n          error as Error\n        );\n      }\n\n      return { nft, ...output };\n    },\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type MintCandyMachineV2BuilderParams = Omit<\n  MintCandyMachineV2Input,\n  'confirmOptions'\n> & {\n  /** A key to distinguish the instruction that creates the mint account of the NFT. */\n  createMintAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that initializes the mint account of the NFT. */\n  initializeMintInstructionKey?: string;\n\n  /** A key to distinguish the instruction that creates the associated token account of the NFT. */\n  createAssociatedTokenAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that creates the token account of the NFT. */\n  createTokenAccountInstructionKey?: string;\n\n  /** A key to distinguish the instruction that initializes the token account of the NFT. */\n  initializeTokenInstructionKey?: string;\n\n  /** A key to distinguish the instruction that mints the one token. */\n  mintTokensInstructionKey?: string;\n\n  /** A key to distinguish the instruction that mints the NFT. */\n  mintNftInstructionKey?: string;\n\n  /** A key to distinguish the instruction that sets the collection on the minted NFT. */\n  setCollectionInstructionKey?: string;\n};\n\n/**\n * @group Transaction Builders\n * @category Contexts\n */\nexport type MintCandyMachineV2BuilderContext = Omit<\n  MintCandyMachineV2Output,\n  'response' | 'nft'\n>;\n\n/**\n * Mint an NFT from an existing Candy Machine.\n *\n * ```ts\n * const transactionBuilder = await metaplex\n *   .candyMachinesV2()\n *   .builders()\n *   .mint({ candyMachine });\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const mintCandyMachineV2Builder = async (\n  metaplex: Metaplex,\n  params: MintCandyMachineV2BuilderParams,\n  options: TransactionBuilderOptions = {}\n): Promise<TransactionBuilder<MintCandyMachineV2BuilderContext>> => {\n  const { programs, payer = metaplex.rpc().getDefaultFeePayer() } = options;\n  const {\n    candyMachine,\n    newMint = Keypair.generate(),\n    newOwner = metaplex.identity().publicKey,\n    newToken,\n  } = params;\n\n  const tokenMetadataProgram = metaplex\n    .programs()\n    .getTokenMetadata(programs).address;\n\n  const newMetadata = metaplex.nfts().pdas().metadata({\n    mint: newMint.publicKey,\n    programs,\n  });\n  const newEdition = metaplex.nfts().pdas().masterEdition({\n    mint: newMint.publicKey,\n    programs,\n  });\n  const candyMachineCreator = findCandyMachineV2CreatorPda(\n    candyMachine.address\n  );\n  const candyMachineCollectionAddress = findCandyMachineV2CollectionPda(\n    candyMachine.address\n  );\n  const candyMachineCollectionAccount = parseCandyMachineV2CollectionAccount(\n    await metaplex.rpc().getAccount(candyMachineCollectionAddress)\n  );\n\n  const tokenWithMintBuilder = await metaplex\n    .tokens()\n    .builders()\n    .createTokenWithMint(\n      {\n        decimals: 0,\n        initialSupply: token(1),\n        mint: newMint,\n        mintAuthority: payer,\n        freezeAuthority: payer.publicKey,\n        owner: newOwner,\n        token: newToken,\n        createMintAccountInstructionKey: params.createMintAccountInstructionKey,\n        initializeMintInstructionKey: params.initializeMintInstructionKey,\n        createAssociatedTokenAccountInstructionKey:\n          params.createAssociatedTokenAccountInstructionKey,\n        createTokenAccountInstructionKey:\n          params.createTokenAccountInstructionKey,\n        initializeTokenInstructionKey: params.initializeTokenInstructionKey,\n        mintTokensInstructionKey: params.mintTokensInstructionKey,\n      },\n      { payer, programs }\n    );\n\n  const { tokenAddress } = tokenWithMintBuilder.getContext();\n\n  const mintNftInstruction = createMintNftInstruction(\n    {\n      candyMachine: candyMachine.address,\n      candyMachineCreator,\n      payer: payer.publicKey,\n      wallet: candyMachine.walletAddress,\n      metadata: newMetadata,\n      mint: newMint.publicKey,\n      mintAuthority: payer.publicKey,\n      updateAuthority: payer.publicKey,\n      masterEdition: newEdition,\n      tokenMetadataProgram,\n      clock: SYSVAR_CLOCK_PUBKEY,\n      recentBlockhashes: SYSVAR_SLOT_HASHES_PUBKEY,\n      instructionSysvarAccount: SYSVAR_INSTRUCTIONS_PUBKEY,\n    },\n    { creatorBump: candyMachineCreator.bump }\n  );\n\n  if (candyMachine.whitelistMintSettings) {\n    const whitelistToken =\n      params.whitelistToken ??\n      metaplex.tokens().pdas().associatedTokenAccount({\n        mint: candyMachine.whitelistMintSettings.mint,\n        owner: payer.publicKey,\n      });\n\n    mintNftInstruction.keys.push(\n      {\n        pubkey: whitelistToken,\n        isWritable: true,\n        isSigner: false,\n      },\n      {\n        pubkey: candyMachine.whitelistMintSettings.mint,\n        isWritable: true,\n        isSigner: false,\n      },\n      {\n        pubkey: payer.publicKey,\n        isWritable: false,\n        isSigner: true,\n      }\n    );\n  }\n\n  if (candyMachine.tokenMintAddress) {\n    const payerToken =\n      params.payerToken ??\n      metaplex.tokens().pdas().associatedTokenAccount({\n        mint: candyMachine.tokenMintAddress,\n        owner: payer.publicKey,\n      });\n\n    mintNftInstruction.keys.push(\n      {\n        pubkey: payerToken,\n        isWritable: true,\n        isSigner: false,\n      },\n      {\n        pubkey: payer.publicKey,\n        isWritable: false,\n        isSigner: true,\n      }\n    );\n  }\n\n  return (\n    TransactionBuilder.make<MintCandyMachineV2BuilderContext>()\n      .setFeePayer(payer)\n      .setContext({\n        mintSigner: newMint,\n        tokenAddress,\n      })\n\n      // Create token and mint accounts.\n      .add(tokenWithMintBuilder)\n\n      // Create the new NFT.\n      .add({\n        instruction: mintNftInstruction,\n        signers: [payer, newMint],\n        key: params.mintNftInstructionKey ?? 'mintNft',\n      })\n\n      // Set the collection on the NFT.\n      .when(candyMachineCollectionAccount.exists, (builder) => {\n        assertAccountExists(candyMachineCollectionAccount);\n        const collectionMint = candyMachineCollectionAccount.data.mint;\n        const collectionMetadata = metaplex.nfts().pdas().metadata({\n          mint: collectionMint,\n          programs,\n        });\n        const collectionMasterEdition = metaplex.nfts().pdas().masterEdition({\n          mint: collectionMint,\n          programs,\n        });\n        const collectionAuthorityRecord = metaplex\n          .nfts()\n          .pdas()\n          .collectionAuthorityRecord({\n            mint: collectionMint,\n            collectionAuthority: candyMachineCollectionAccount.publicKey,\n            programs,\n          });\n\n        return builder.add({\n          instruction: createSetCollectionDuringMintInstruction({\n            candyMachine: candyMachine.address,\n            metadata: newMetadata,\n            payer: payer.publicKey,\n            collectionPda: candyMachineCollectionAccount.publicKey,\n            tokenMetadataProgram,\n            instructions: SYSVAR_INSTRUCTIONS_PUBKEY,\n            collectionMint: candyMachineCollectionAccount.data.mint,\n            collectionMetadata,\n            collectionMasterEdition,\n            authority: candyMachine.authorityAddress,\n            collectionAuthorityRecord,\n          }),\n          signers: [payer],\n          key: params.setCollectionInstructionKey ?? 'setCollection',\n        });\n      })\n  );\n};\n"],"names":["Key","mintCandyMachineV2Operation","useOperation","mintCandyMachineV2OperationHandler","handle","operation","metaplex","scope","assertCanMintCandyMachineV2","input","candyMachine","payer","builder","mintCandyMachineV2Builder","throwIfCanceled","confirmOptions","makeConfirmOptionsFinalizedOnMainnet","output","sendAndConfirm","nft","nfts","findByMint","mintAddress","mintSigner","publicKey","tokenAddress","error","CandyMachineV2BotTaxError","rpc","getSolanaExporerUrl","response","signature","params","options","programs","getDefaultFeePayer","newMint","Keypair","generate","newOwner","identity","newToken","tokenMetadataProgram","getTokenMetadata","address","newMetadata","pdas","metadata","mint","newEdition","masterEdition","candyMachineCreator","findCandyMachineV2CreatorPda","candyMachineCollectionAddress","findCandyMachineV2CollectionPda","candyMachineCollectionAccount","parseCandyMachineV2CollectionAccount","getAccount","tokenWithMintBuilder","tokens","builders","createTokenWithMint","decimals","initialSupply","token","mintAuthority","freezeAuthority","owner","createMintAccountInstructionKey","initializeMintInstructionKey","createAssociatedTokenAccountInstructionKey","createTokenAccountInstructionKey","initializeTokenInstructionKey","mintTokensInstructionKey","getContext","mintNftInstruction","createMintNftInstruction","wallet","walletAddress","updateAuthority","clock","SYSVAR_CLOCK_PUBKEY","recentBlockhashes","SYSVAR_SLOT_HASHES_PUBKEY","instructionSysvarAccount","SYSVAR_INSTRUCTIONS_PUBKEY","creatorBump","bump","whitelistMintSettings","whitelistToken","associatedTokenAccount","keys","push","pubkey","isWritable","isSigner","tokenMintAddress","payerToken","TransactionBuilder","make","setFeePayer","setContext","add","instruction","signers","key","mintNftInstructionKey","when","exists","assertAccountExists","collectionMint","data","collectionMetadata","collectionMasterEdition","collectionAuthorityRecord","collectionAuthority","createSetCollectionDuringMintInstruction","collectionPda","instructions","authority","authorityAddress","setCollectionInstructionKey"],"mappings":"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"}